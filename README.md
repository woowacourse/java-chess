## 이번 미션의 목표

- SRP
- 모든 변수명에 `final` 붙이기
    - 당연히 메서드 파라미터에도 `final`을 붙인다.
- 모든 원시값과 문자열을 포장한다.
- 일급 컬렉션을 쓴다.
- 객체지향생활체조를 모두 만족한다.
    - 9번은 쓰지 않는다 말고 지양한다 수준으로 맞춰본다.
- 모든 클래스에 `abstract` 혹은 `final`을 추가한다.
- 추상 클래스의 메서드에 `abstract` 혹은 `final`을 추가한다.

## 추가된 프로그래밍 요구 사항

- DB를 적용할 때 도메인 객체의 변경을 최소화해야한다.

## 3단계 추가된 기능 요구사항

- 체스 게임은 상대편 King이 잡히는 경우 게임에서 진다.**King이 잡혔을 때 게임을 종료해야 한다.**
- **체스 게임은 현재 남아 있는 말에 대한 점수를 구할 수 있어야 한다.**
- "status" 명령을 입력하면 각 진영의 점수를 출력하고 **어느 진영이 이겼는지 결과를 볼 수 있어야 한다.**
- 점수 계산 규칙
    - 체스 프로그램에서 현재까지 남아 있는 말에 따라 점수를 계산할 수 있어야 한다.
    - 각 말의 점수는 queen은 9점, rook은 5점, bishop은 3점, knight는 2.5점이다.
    - pawn의 기본 점수는 1점이다. 하지만 같은 세로줄에 같은 색의 폰이 있는 경우 1점이 아닌 0.5점을 준다.
    - king은 잡히는 경우 경기가 끝나기 때문에 점수가 없다.
    - 한 번에 한 쪽의 점수만을 계산해야 한다.

## 요구 사항 분석

### ChessGame 패키지

- [x]  ChessGame
    - [x]  `Turn`
- [x]  ScoreCalculator : Enum
    - [x]  calculateScore()
- [x]  Turn
    - [x]  불변 객체화

### ChessBoard 패키지

- [x]  ChessBoard
    - [x]  `Map<Position, SquareStatus>` chessBoard

### AbstractPiece 패키지

- [x]  JumperPiece
- [x]  PawnFeature
- [x]  SlidingPiece

### ~~Coordinate~~ → Position 패키지

---

## 4단계 추가된 기능 요구사항

### **필수 요구사항**

- 애플리케이션을 재시작하더라도 이전에 하던 체스 게임을 다시 시작할 수 있어야 한다.
- **DB를 적용할 때 도메인 객체의 변경을 최소화해야한다.**

### **선택 요구사항**

- 체스 게임방을 만들고 체스 게임방에 입장할 수 있는 기능을 추가한다.
- 사용자별로 체스 게임 기록을 관리할 수 있다.

## 요구 사항 분석

### DAO 패키지

- [x]  ChessDao

### DTO 패키지

- [x]  ChessBoardDto
- [x]  MoveDto

---

## 주요 변경 사항

- [x]  ChessBoard 이차원 리스트에서 Map 형태로 변경
    - [x]  Map 내부에는 Piece들만 들어가있고, 없는 Position을 get할 경우 Empty 반환
- [x]  AbstractPiece 추가
    - [x]  Piece들을 공통점끼리 묶어 다시 한번 추상화
        - [x]  PawnFeature
        - [x]  JumperPiece
        - [x]  SlidingPiece
- [x]  Position 캐싱 이차원 리스트에서 이중 Map 형태로 변경
    - [x]  Map 내부에 값이
        - [x]  있으면 바로 리턴
        - [x]  없으면 새로 만들어 리턴
- [x]  Controller 상의 인스턴스 변수 제거 및 지역변수화
- [x]  3단계 적용
- [x]  4단계적용

## 질문 사항
- [x]  한 객체를 불변 객체로 바꾸면 그 객체를 인스턴스 변수로 가지고 있던 래퍼 클래스는 가변이 됩니다.
  이 가변 객체를 private final 인스턴스 변수로 가지고 있고, 가변 객체의 상태를 바꾸는 메서드를 가지고 있지 않은 래퍼 클래스는 가변인가요?

- [x]  위의 질문과 이어서 객체를 불변으로 만들기 위해서 타고 타고 올라가다보면,
  하위 객체에서 값 하나가 바뀌는데 Controller가 바뀌는 경우가 발생할 것 같습니다.
  현업에서 이런 방법을 쓰지는 않을 것 같은데 멀티스레딩 환경에 대해 어떻게 대처하나요?

- [x]  controller의 상태를 chessGame으로 내리고, chessGame 상위에 service layer를 둬서
  DB와의 연결을 책임지고 이 service를 controller가 호출하게 만들고 싶었으나…. 실패했습니다.
  그래서 Controller 상의 인스턴스 변수를 제거하고 지역변수로 만들어주는 정도로 그쳤습니다.
  특히 Status의 반환타입이 double이 되면서 더 어려워졌는데, 그럼에도 불구하고 위 구조를 적용할 수 있는 방법이 있을까요??

- [x]  승패에 관해, 지금은 OutputView에서 double 값 두개만 받고,
    누가 이기고 있는지는 OutputView에서 판단해서 출력하고 있습니다.
    view를 프론트엔드라고 가정하면 이정도 연산 정도는 할 수 있을 것 같은데 이 방법이 괜찮을까요?
    DTO에 승자의 이름까지 포함해서 보내는 방법을 써야할까요?
